name: Build LaTeX Resume
on:
  push:
    paths:
      - '**.tex'      # tex 파일이 바뀔 때만 작동
      - 'index.html'  # html 수정할 때도 작동하도록 설정
      - '.github/workflows/**'

permissions:
  contents: write     # 깃허브 봇에게 쓰기 권한 부여

jobs:
  build_latex:
    runs-on: ubuntu-latest
    steps:
      - name: 저장소 체크아웃
        uses: actions/checkout@v3

      - name: LaTeX 컴파일
        uses: xu-cheng/latex-action@v3
        with:
          root_file: main.tex  # 파일명이 main.tex가 아니면 수정 필요

      - name: PDF 파일 저장소에 반영 (Commit & Push)
        run: |
          git config --global user.name "GitHub Action Bot"
          git config --global user.email "action@github.com"
          
          # PDF가 생성되었는지 확인 후 커밋
          if [ -f main.pdf ]; then
            git add main.pdf
            git commit -m "Auto-compiled Resume PDF [skip ci]"
            git pull --rebase origin main
            git push
          else
            echo "PDF generation failed."
            exit 1
          fi